# /etc/ntp.conf, configuration for ntpd

# This file is being maintained by Puppet.
# DO NOT EDIT

driftfile /var/lib/ntp/ntp.drift
statsdir /var/log/ntpstats/
enable kernel ntp stats

statistics loopstats peerstats clockstats
filegen loopstats file loopstats type day enable
filegen peerstats file peerstats type day enable
filegen clockstats file clockstats type day enable 

# pool.ntp.org maps to more than 300 low-stratum NTP servers.
# Your server will pick a different set every time it starts up.
#  *** Please consider joining the pool! ***
#  *** <http://www.pool.ntp.org/join.html> ***
<% num = 0 %><% server_servers.each do |ntpServer| -%>			<% if num == 0 then %>
server <%= ntpServer %>	iburst minpoll 4 maxpoll 10 burst prefer	<% elsif num == 1 %>
server <%= ntpServer %>	iburst minpoll 6 maxpoll 12 burst prefer	<% else %>
server <%= ntpServer %>	iburst minpoll 8 maxpoll 16 burst
<% end %><% num = num + 1 %><% end -%>


# in case of failure, we're our own stratum server
server 127.127.1.0
fudge 127.127.1.0 stratum 10

# By default, exchange time with everybody, but don't allow configuration.
# See /usr/share/doc/ntp-doc/html/accopt.html for details.
restrict -4 default kod notrap nomodify nopeer noquery
restrict -6 default kod notrap nomodify nopeer noquery

# Local users may interrogate the ntp server more closely.
restrict 127.0.0.1 nomodify
restrict ::1 nomodify

# ignore all the world, except our server list
restrict default ignore
<% server_servers.each do |ntpServer| -%>
restrict <%= ntpServer %>
<% end -%>

# Clients from this (example!) subnet have unlimited access,
# but only if cryptographically authenticated
#restrict 192.168.123.0  mask  255.255.255.0 notrust

# Clients from this subnets have ro access.
<% client_list.each do |ntpClient| -%>
restrict <%= ntpClient.sub(/\//, ' mask ') %> nomodify
<% end -%>

# If you want to provide time to your local subnet, change the next line.
# (Again, the address is an example only.)
#broadcast 192.168.123.255

# If you want to listen to time broadcasts on your local subnet,
# de-comment the next lines. Please do this only if you trust everybody
# on the network!
#disable auth
#broadcastclient
